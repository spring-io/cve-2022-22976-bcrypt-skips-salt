package org.springframework.security.bcrypt.check;

import org.junit.jupiter.api.Test;

import org.springframework.security.bcrypt.hashes.PasswordHash;
import org.springframework.security.bcrypt.hashes.PasswordHashRepository;
import org.springframework.security.bcrypt.hashes.TestPasswordHashRepositories;

import static org.mockito.Mockito.mock;
import static org.mockito.Mockito.verify;

public class CheckCommandTests {
	@Test
	void givenBadHashesWithPrefixThenCommandAdvises() {
		CheckView view = mock(CheckView.class);
		PasswordHashRepository<PasswordHash> hashes = TestPasswordHashRepositories.withPrefix();
		CheckCommand command = new CheckCommand(hashes, view);
		command.run();
		verify(view).updatesNeeded();
	}

	@Test
	void givenBadHashesWithoutPrefixThenCommandAdvises() {
		CheckView view = mock(CheckView.class);
		PasswordHashRepository<PasswordHash> hashes = TestPasswordHashRepositories.withoutPrefix();
		CheckCommand command = new CheckCommand(hashes, view);
		command.run();
		verify(view).updatesNeeded();
	}

	@Test
	void givenOkayHashesThenCommandAdvises() {
		CheckView view = mock(CheckView.class);
		PasswordHashRepository<PasswordHash> hashes = TestPasswordHashRepositories.okay();
		CheckCommand command = new CheckCommand(hashes, view);
		command.run();
		verify(view).noUpdatesNeeded();
	}
}
