package org.springframework.security.bcrypt.sample;

import java.util.Map;

import org.junit.jupiter.api.Test;

import static org.mockito.Mockito.mock;
import static org.mockito.Mockito.spy;
import static org.mockito.Mockito.verify;

public class CheckCommandTests {
    @Test
    void givenBadHashesWithPrefixThenCommandAdvises() {
        ConsoleCheckView view = spy(new ConsoleCheckView());
        Map<Long, String> hashes = TestHashes.withPrefix();
        CheckCommand command = new CheckCommand(hashes, view);
        command.run();
        verify(view).updatesNeeded();
    }

    @Test
    void givenBadHashesWithoutPrefixThenCommandAdvises() {
        ConsoleCheckView view = spy(new ConsoleCheckView());
        Map<Long, String> hashes = TestHashes.withoutPrefix();
        CheckCommand command = new CheckCommand(hashes, view);
        command.run();
        verify(view).updatesNeeded();
    }

    @Test
    void givenOkayHashesThenCommandAdvises() {
        ConsoleCheckView view = spy(new ConsoleCheckView());
        Map<Long, String> hashes = TestHashes.okay();
        CheckCommand command = new CheckCommand(hashes, view);
        command.run();
        verify(view).noUpdatesNeeded();
    }
}
